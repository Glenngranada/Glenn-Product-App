<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="furkan-logo.jpg" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />

    <title>Stock App</title>

    <script src="jschannel.js"></script>

    
    
    <script>
      function getProductsFromIndecDB() {
          return new Promise((resolve, reject) => {
              // Open a connection to the IndexedDB database
              const request = window.indexedDB.open('glenn-app-store-db');

              // Event handler for successful database opening
              request.onsuccess = function (event) {
                  console.log(event, 'on success query')
                  const db = event.target.result;

                  // Start a transaction to access the database
                  const transaction = db.transaction(['products'], 'readonly');

                  // Retrieve the object store
                  const objectStore = transaction.objectStore('products');

                  // Open a cursor to iterate over the records in the object store
                  const cursorRequest = objectStore.openCursor();
                  let products = [];

                  // Event handler for cursor success
                  cursorRequest.onsuccess = function (event) {
                      const cursor = event.target.result;
                      if (cursor) {
                          // Access the data associated with the current cursor position
                          // console.log(cursor.value);
                          products.push(cursor.value);
                          // Move to the next record in the object store
                          cursor.continue();
                      } else {
                          console.log('No more data');
                          resolve(products); // Resolve the promise with the products array
                      }
                  };

                  // Event handler for cursor error
                  cursorRequest.onerror = function (event) {
                      console.error('Cursor error', event.target.error);
                      reject(new Error('Cursor error: ' + event.target.error));
                  };
              };

              // Event handler for database open error
              request.onerror = function (event) {
                  console.log(event, 'onerror query')
                  console.error('Database open error', event.target.error);
                  reject(new Error('Database open error: ' + event.target.error));
              };
          });
      }
      let products = getProductsFromIndecDB()
        .then(products => {
            console.log('Products:', products);

            var chan = Channel.build({window: window.parent, origin: "*", scope: "testScope"});

            chan.bind("reverse", function(trans, s) {
              console.log(products, 'products')
              return products;
            });
            return products;
        })
        .catch(error => {
            console.error('Error:', error);
        });

      

      

      // function getProductsFromIndecDB(){
      //   // Open a connection to the IndexedDB database
      //   const request = window.indexedDB.open('glenn-app-store-db');

      //   // Event handler for successful database opening
      //   request.onsuccess = function(event) {
      //       console.log(event, 'on success query')
      //       const db = event.target.result;

      //       // Start a transaction to access the database
      //       const transaction = db.transaction(['products'], 'readonly');

      //       // Retrieve the object store
      //       const objectStore = transaction.objectStore('products');

      //       // Open a cursor to iterate over the records in the object store
      //       const cursorRequest = objectStore.openCursor();
      //       let products = [];
      //       // Event handler for cursor success
      //       cursorRequest.onsuccess = function(event) {
      //           const cursor = event.target.result;
      //           if (cursor) {
      //             // Access the data associated with the current cursor position
      //             console.log(cursor.value);
      //             products.push(cursor.value);
      //             // Move to the next record in the object store
      //             cursor.continue();
      //           } else {
      //             console.log('No more data');
      //           }
      //           return products;
      //       };

      //       // Event handler for cursor error
      //       cursorRequest.onerror = function(event) {
      //           console.error('Cursor error', event.target.error);
      //       };
      //   };

      //   // Event handler for database open error
      //   request.onerror = function(event) {
      //       console.log(event, 'onerror query')
      //       console.error('Database open error', event.target.error);
      //   };
      // }

      // window.addEventListener('message', (message) => {
      //   console.log('received message from panent domain', message);
      //   callback('you called me');
      //   if (message.origin === 'http://www.bbb.com') {
      //     const data = JSON.parse(message.data);
      //     const { userId } = data;

      //     if (userId){
      //       localStorage.setItem('userId', userId);
      //     }
      //   }
      // });
  </script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
  </body>
</html>
